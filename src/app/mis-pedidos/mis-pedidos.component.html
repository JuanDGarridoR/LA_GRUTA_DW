<div class="container mt-4">
  <h2 class="text-center mb-4">Mis Pedidos</h2>

  <!-- Si no hay pedidos -->
  <div
    *ngIf="pedidos.length === 0"
    class="alert alert-info text-center shadow-sm"
  >
    No tienes pedidos registrados todavía.
  </div>

  <!-- Lista de pedidos -->
  <div
    *ngFor="let pedido of pedidos"
    class="card mb-4 shadow-sm border-0 pedido-card"
  >
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Pedido #{{ pedido.id }}</strong>
      <span
        class="badge estado"
        [ngClass]="{
          'bg-secondary': pedido.estado === 'recibido',
          'bg-warning text-dark': pedido.estado === 'cocinando',
          'bg-info text-dark': pedido.estado === 'enviado',
          'bg-success': pedido.estado === 'entregado'
        }"
      >
        {{ pedido.estado | titlecase }}
      </span>
    </div>

    <div class="card-body">
      <p>
        <strong>Fecha:</strong> {{ pedido.creadoEn | date:'medium' }}
      </p>

      <!-- Lista de comidas -->
      <div *ngIf="pedido.items && pedido.items.length > 0">
        <h5 class="mt-3 mb-2">Productos</h5>
        <ul class="list-group list-group-flush">
          <li
            *ngFor="let item of pedido.items"
            class="list-group-item border-0"
          >
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ item.comida?.nombre }}</strong>
                <span class="text-muted">×{{ item.cantidad }}</span>
                <br />
                <small class="text-muted">
                  Precio unitario:
                  {{
                    item.comida?.precio | currency : "COP" : "symbol" : "1.0-0"
                  }}
                </small>
              </div>
              <div>
                <strong>
                  {{
                    subtotalItem(item) | currency : "COP" : "symbol" : "1.0-0"
                  }}
                </strong>
              </div>
            </div>

            <!-- Adicionales -->
            <div *ngIf="item.adicionales?.length" class="mt-2">
              <small class="text-muted">Adicionales:</small>
              <ul class="ms-3 mb-0">
                <li *ngFor="let adicional of item.adicionales">
                  {{ adicional.nombre }}
                  ({{
                    adicional.precio | currency : "COP" : "symbol" : "1.0-0"
                  }})
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>

      <!-- Total general del pedido -->
      <div
        class="total-pedido mt-3 pt-2 border-top d-flex justify-content-between align-items-center"
      >
        <strong>Total del pedido:</strong>
        <strong class="text-success">
          {{
            calcularTotalDesdeItems(pedido)
              | currency : "COP" : "symbol" : "1.0-0"
          }}
        </strong>
      </div>

      <!-- Fecha de entrega -->
      <p *ngIf="pedido.fechaEntrega" class="mt-3 mb-0">
        <strong>Entregado el:</strong>
        {{ pedido.fechaEntrega | date : "medium" }}
      </p>
    </div>
  </div>
</div>
