<div class="container-fluid my-4">
  <h1 class="mb-4">Portal del Operador: Pedidos Activos</h1>

  <div class="table-responsive shadow-sm">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID Pedido</th>
          <th>Cliente</th>
          <th>Detalle del Pedido</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Domiciliario</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pedido of pedidos">
          <td>#{{ pedido.id }}</td>

          <!-- ðŸ”¹ Ajuste: cliente â†’ user -->
          <td>{{ pedido.user?.username }}</td>

          <td>
            <ul>
              <li *ngFor="let item of pedido.items">
                <!-- ðŸ”¹ Ajuste: eliminar operador ?. innecesario -->
                <strong>{{ item.cantidad }}x</strong> {{ item.comida.nombre }}

                <ul
                  *ngIf="item.adicionales && item.adicionales.length > 0"
                  class="adicionales-list"
                >
                  <li *ngFor="let adicional of item.adicionales">
                    + {{ adicional.nombre }}
                  </li>
                </ul>
              </li>
            </ul>
          </td>

          <td>{{ formatCOP(pedido.total) }}</td>


          <td>
            <span
  class="badge text-uppercase"
  [class.bg-primary]="pedido.estado === 'recibido'"
  [class.bg-warning]="pedido.estado === 'cocinando'"
  [class.bg-info]="pedido.estado === 'enviado'"
  [class.bg-success]="pedido.estado === 'entregado'"
  [class.text-dark]="pedido.estado === 'cocinando' || pedido.estado === 'enviado'"
>
  {{ pedido.estado }}
</span>



          </td>

          <td>
            <div *ngIf="pedido.domiciliarioAsignado; else noAsignado">
              <div>{{ pedido.domiciliarioAsignado.nombre }}</div>
              <small class="text-muted">
                {{ pedido.domiciliarioAsignado.telefono }}
              </small>
            </div>
            <ng-template #noAsignado>N/A</ng-template>
          </td>

          <td class="text-center">
            <button
              *ngIf="pedido.estado === 'recibido'"
              class="btn btn-sm btn-primary"
              (click)="marcarCocinando(pedido.id)"
            >
              Marcar como Cocinando
            </button>

            <button
              *ngIf="pedido.estado === 'cocinando'"
              class="btn btn-sm btn-warning"
              (click)="marcarEnviado(pedido.id)"
            >
              Asignar y Enviar
            </button>

            <button
              *ngIf="pedido.estado === 'enviado'"
              class="btn btn-sm btn-info"
              (click)="marcarEntregado(pedido.id)"
            >
              Marcar como Entregado
            </button>

            <span *ngIf="pedido.estado === 'entregado'">Completado</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
