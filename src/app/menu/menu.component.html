<main class="container my-5">
  <h2 class="text-center mb-5">Men√∫</h2>

  <!-- Iterar sobre cada categor√≠a -->
  <section *ngFor="let cat of categorias" [id]="cat.slug" class="mb-5">
    <h2 class="text-center mb-4">{{ cat.nombre }}</h2>

    <div class="row g-4">
      <!-- Mostrar solo las comidas de esta categor√≠a -->
      <ng-container *ngFor="let comida of getComidasPorCategoria(cat.slug)">
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm">
            <!-- Imagen del plato -->
            <img
              [src]="getImageUrl(comida.imagen)"
              class="card-img-top"
              [alt]="comida.nombre"
              style="height: 200px; object-fit: cover"
            />

            <!-- Cuerpo de la tarjeta -->
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ comida.nombre }}</h5>
              <p class="card-text">{{ comida.descripcion }}</p>

              <div class="mt-auto d-flex flex-column">
                <!-- Precio y bot√≥n de adicionales -->
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="fw-bold">
                    {{ comida.precio | currency : "COP" }}
                  </span>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    (click)="verAdicionales(comida)"
                  >
                    Ver Adicionales
                  </button>
                </div>

                <!-- Controles de cantidad -->
                <div
                  class="quantity-controls mb-2 d-flex align-items-center gap-2"
                >
                  <button
                    class="btn btn-sm btn-secondary"
                    (click)="restarCantidad(comida)"
                  >
                    -
                  </button>
                  <span>{{ comida.cantidad || 0 }}</span>
                  <button
                    class="btn btn-sm btn-secondary"
                    (click)="sumarCantidad(comida)"
                  >
                    +
                  </button>
                </div>

                <!-- Bot√≥n Agregar -->
                <button
                  class="btn btn-primary mt-auto"
                  (click)="onAgregarClick(comida)"
                >
                  Agregar
                </button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <p
      *ngIf="getComidasPorCategoria(cat.slug).length === 0"
      class="text-muted text-center mt-3"
    >
      No hay platos disponibles en esta categor√≠a.
    </p>
  </section>

  <div class="text-center mb-4 pt-5">
    <a routerLink="/tabla-comidas" class="btn btn-menu">
      Ver todos nuestros platos
    </a>
  </div>

  <!-- MODAL DE ADICIONALES -->
  <div
    class="modal-backdrop"
    *ngIf="showExtrasModal"
    (click)="showExtrasModal = false"
  ></div>

  <div class="modal-custom" *ngIf="showExtrasModal">
    <div class="modal-header">
      <h5 class="fw-bold m-0">Arma tu pedido</h5>
      <button
        type="button"
        class="btn-close"
        (click)="showExtrasModal = false"
      ></button>
    </div>

    <div class="modal-body">
      <div class="row">
        <!-- COMIDA PRINCIPAL -->
        <div class="col-lg-5 text-center mb-4 mb-lg-0 border-end">
          <img
            [src]="getImageUrl(selectedComida?.imagen)"
            [alt]="selectedComida?.nombre"
            class="img-fluid rounded shadow-sm mb-3"
            style="max-height: 220px; object-fit: cover"
          />
          <h5 class="fw-bold">{{ selectedComida?.nombre }}</h5>
          <p class="text-muted small">{{ selectedComida?.descripcion }}</p>
          <p class="fw-bold text-danger mb-0">
            {{ selectedComida?.precio | currency : "COP" }}
          </p>
        </div>

        <!-- ADICIONALES -->
        <div class="col-lg-7 ps-lg-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="fw-bold mb-0">Acompa√±amientos</h6>
            <small class="text-muted"
              >{{ selectedAdicionales.length }}/4 seleccionados</small
            >
          </div>
          <p class="text-muted small">Puedes elegir hasta 4 adicionales</p>

          <div *ngIf="loadingExtras" class="text-center py-4">
            <div class="spinner-border text-danger" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>

          <div
            *ngIf="!loadingExtras && extras.length > 0"
            class="list-group list-group-flush"
          >
            <label
              *ngFor="let adicional of extras"
              class="list-group-item d-flex justify-content-between align-items-center list-hover"
            >
              <div class="d-flex align-items-center gap-3">
                <img
                  [src]="getImageUrl(adicional.imagen)"
                  alt="{{ adicional.nombre }}"
                  class="rounded"
                  width="60"
                  height="60"
                  style="object-fit: cover"
                />
                <div>
                  <h6 class="mb-0">{{ adicional.nombre }}</h6>
                  <small class="text-muted">{{ adicional.descripcion }}</small>
                </div>
              </div>
              <div class="text-end">
                <div class="text-danger small">
                  +{{ adicional.precio | currency : "COP" }}
                </div>
                <input
                  type="checkbox"
                  [checked]="isAdicionalSeleccionado(adicional)"
                  (change)="toggleAdicional(adicional)"
                />
              </div>
            </label>
          </div>

          <p
            *ngIf="!loadingExtras && extras.length === 0"
            class="text-muted text-center mt-3"
          >
            No hay adicionales disponibles para esta categor√≠a.
          </p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="showExtrasModal = false">
        Cancelar
      </button>
      <button
        class="btn btn-primary"
        (click)="confirmarSeleccion()"
      >
        Confirmar selecci√≥n
      </button>
    </div>
  </div>

  <!-- TOAST -->
  <div
    class="toast-container position-fixed bottom-0 end-0 p-3"
    style="z-index: 2000;"
  >
    <div
      id="pedidoToast"
      class="toast align-items-center text-white border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body fw-bold">
          üõçÔ∏è ¬°Tu pedido ha sido agregado al carrito!
        </div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>
</main>
